document.addEventListener('DOMContentLoaded',function(){let totalPhotos=0;let loadedPhotos=0;let loadingInProgress=false;let existingReferences=new Set();function loadPhotos(resetFilters=false){const category=document.getElementById('category-filter').value||'';const format=document.getElementById('format-filter').value||'';const order=document.getElementById('order-filter').value||'DESC';const params=new URLSearchParams({action:'filter_photos',category:category,format:format,order:order});console.log('Loading photos with params:',params.toString());fetch(`${nathalie_mota_ajax.url}?${params.toString()}`,{method:'GET'}).then(response=>response.json()).then(responseData=>{console.log('Photos loaded:',responseData);const photoList=document.getElementById('photo-list');if(resetFilters){photoList.innerHTML='';existingReferences.clear();}
const tempDiv=document.createElement('div');tempDiv.innerHTML=responseData.html;tempDiv.querySelectorAll('.photo-item').forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');if(!existingReferences.has(photoReference)){photoList.appendChild(photoItem);existingReferences.add(photoReference);}});totalPhotos=responseData.total;loadedPhotos=photoList.querySelectorAll('.photo-item').length;console.log('Total photos:',totalPhotos);console.log('Loaded photos:',loadedPhotos);const loadMoreButton=document.getElementById('load-more');if(loadedPhotos<totalPhotos){loadMoreButton.style.display='block';}else{loadMoreButton.style.display='none';}
addLightboxEvents();}).catch(error=>{console.error('Error:',error);});}
document.getElementById('category-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('format-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('order-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('load-more').addEventListener('click',function(){if(loadingInProgress)return;loadingInProgress=true;const offset=document.getElementById('photo-list').querySelectorAll('.photo-item').length;console.log('Load more clicked, current offset:',offset);const category=document.getElementById('category-filter').value||'';const format=document.getElementById('format-filter').value||'';const order=document.getElementById('order-filter').value||'DESC';const params=new URLSearchParams({action:'load_more_photos',offset:offset,category:category,format:format,order:order});console.log('Loading more photos with params:',params.toString());fetch(`${nathalie_mota_ajax.url}?${params.toString()}`,{method:'GET'}).then(response=>response.json()).then(responseData=>{console.log('More photos loaded:',responseData);const photoList=document.getElementById('photo-list');const tempDiv=document.createElement('div');tempDiv.innerHTML=responseData.html;tempDiv.querySelectorAll('.photo-item').forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');if(!existingReferences.has(photoReference)){photoList.appendChild(photoItem);existingReferences.add(photoReference);}});loadedPhotos=photoList.querySelectorAll('.photo-item').length;console.log('Updated loaded photos:',loadedPhotos);if(loadedPhotos>=totalPhotos){document.getElementById('load-more').style.display='none';}else{document.getElementById('load-more').style.display='block';}
loadingInProgress=false;addLightboxEvents();}).catch(error=>{console.error('Error:',error);loadingInProgress=false;});});console.log('Initial load photos');loadPhotos(true);});