document.addEventListener('DOMContentLoaded',function(){let totalPhotos=0;let loadedPhotos=0;let loadingInProgress=false;let remainingPhotos=[];function loadPhotos(resetFilters=false){const category=document.getElementById('category-filter').value||'';const format=document.getElementById('format-filter').value||'';const order=document.getElementById('order-filter').value||'DESC';const params=new URLSearchParams({action:'filter_photos',category:category,format:format,order:order});console.log('Loading photos with params:',params.toString());fetch(`${nathalie_mota_ajax.url}?${params.toString()}`,{method:'GET'}).then(response=>response.json()).then(responseData=>{console.log('Photos loaded:',responseData);const photoList=document.getElementById('photo-list');if(resetFilters){photoList.innerHTML='';remainingPhotos=[];}
const tempDiv=document.createElement('div');tempDiv.innerHTML=responseData.html;const allPhotos=Array.from(tempDiv.querySelectorAll('.photo-item'));const existingReferences=new Set(Array.from(photoList.querySelectorAll('.photo-item')).map(item=>item.getAttribute('data-reference')));const photosToLoad=allPhotos.slice(0,8);photosToLoad.forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');if(!existingReferences.has(photoReference)){photoList.appendChild(photoItem);existingReferences.add(photoReference);}});remainingPhotos=allPhotos.slice(8);totalPhotos=responseData.total;loadedPhotos=photoList.querySelectorAll('.photo-item').length;const loadMoreButton=document.getElementById('load-more');if(loadedPhotos<totalPhotos){loadMoreButton.style.display='block';}else{loadMoreButton.style.display='none';}
addLightboxEvents();}).catch(error=>{console.error('Error:',error);});}
document.getElementById('load-more').addEventListener('click',function(){if(loadingInProgress||remainingPhotos.length===0)return;loadingInProgress=true;const photoList=document.getElementById('photo-list');const photosToLoad=remainingPhotos.slice(0,8);remainingPhotos=remainingPhotos.slice(8);photosToLoad.forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');photoList.appendChild(photoItem);});loadedPhotos=photoList.querySelectorAll('.photo-item').length;if(remainingPhotos.length===0){this.style.display='none';}else{this.style.display='block';}
loadingInProgress=false;addLightboxEvents();});document.getElementById('category-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('format-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('order-filter').addEventListener('change',()=>loadPhotos(true));console.log('Initial load photos');loadPhotos(true);const customSelects=document.getElementsByClassName("custom-select");Array.from(customSelects).forEach(customSelect=>{const selElmnt=customSelect.getElementsByTagName("select")[0];const selected=document.createElement("DIV");selected.setAttribute("class","select-selected");selected.innerHTML=selElmnt.options[selElmnt.selectedIndex].innerHTML;customSelect.appendChild(selected);const optionsDiv=document.createElement("DIV");optionsDiv.setAttribute("class","select-items select-hide");for(let j=1;j<selElmnt.length;j++){const option=document.createElement("DIV");option.innerHTML=selElmnt.options[j].innerHTML;option.addEventListener("click",function(){const select=this.parentNode.parentNode.getElementsByTagName("select")[0];const selectedDiv=this.parentNode.previousSibling;for(let i=0;i<select.length;i++){if(select.options[i].innerHTML==this.innerHTML){select.selectedIndex=i;selectedDiv.innerHTML=this.innerHTML;const sameAsSelected=this.parentNode.getElementsByClassName("same-as-selected");for(let k=0;k<sameAsSelected.length;k++){sameAsSelected[k].removeAttribute("class");}
this.setAttribute("class","same-as-selected");break;}}
selectedDiv.click();loadPhotos(true);});optionsDiv.appendChild(option);}
customSelect.appendChild(optionsDiv);selected.addEventListener("click",function(e){e.stopPropagation();closeAllSelect(this);this.nextSibling.classList.toggle("select-hide");this.classList.toggle("select-arrow-active");});});function closeAllSelect(elmnt){const x=document.getElementsByClassName("select-items");const y=document.getElementsByClassName("select-selected");const arrNo=[];for(let i=0;i<y.length;i++){if(elmnt==y[i]){arrNo.push(i);}else{y[i].classList.remove("select-arrow-active");}}
for(let i=0;i<x.length;i++){if(!arrNo.includes(i)){x[i].classList.add("select-hide");}}}
document.addEventListener("click",closeAllSelect);});